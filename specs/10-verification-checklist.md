# 総合検証チェックリスト

全仕様の受け入れ基準を集約したマスターチェックリスト。各仕様の実装完了時に更新する。

## 01: アプリケーション構成

| # | 検証項目 | 状態 | 検証日 | 備考 |
|---|----------|------|--------|------|
| 1-1 | FastAPI アプリケーションが起動する | 未検証 | | |
| 1-2 | `GET /health` が正常レスポンスを返す | 未検証 | | |
| 1-3 | `GET /` が API 概要情報を返す | 未検証 | | |
| 1-4 | `GET /docs` で OpenAPI ドキュメントが表示される | 未検証 | | |
| 1-5 | `requirements.txt` に必要なパッケージが定義されている | 未検証 | | |

## 02: Docker 構成

| # | 検証項目 | 状態 | 検証日 | 備考 |
|---|----------|------|--------|------|
| 2-1 | `docker compose build` がエラーなく完了する | 未検証 | | |
| 2-2 | `docker compose up` でコンテナが起動する | 未検証 | | |
| 2-3 | `http://localhost:8000/health` にアクセスできる | 未検証 | | |
| 2-4 | `.env` ファイルが `.gitignore` に含まれている | 未検証 | | |
| 2-5 | `.env.example` がリポジトリに含まれている | 未検証 | | |

## 03: New Relic エージェント設定

| # | 検証項目 | 状態 | 検証日 | 備考 |
|---|----------|------|--------|------|
| 3-1 | `newrelic.ini` が正しい設定で作成されている | 未検証 | | |
| 3-2 | `newrelic-admin run-program` でアプリが起動する | 未検証 | | |
| 3-3 | エージェントログに「Reporting to」メッセージがある | 未検証 | | |
| 3-4 | New Relic One の APM にアプリが表示される | 未検証 | | |
| 3-5 | ヘルスチェックのトランザクションが記録される | 未検証 | | |
| 3-6 | ライセンスキーがソースコードにハードコードされていない | 未検証 | | |

## 04: APM 基本機能

| # | 検証項目 | 状態 | 検証日 | 備考 |
|---|----------|------|--------|------|
| 4-1 | `/api/apm/fast` のトランザクションが記録される | 未検証 | | |
| 4-2 | `/api/apm/slow` のレスポンスタイムが ~2 秒で記録される | 未検証 | | |
| 4-3 | `/api/apm/variable` のレスポンスタイムが遅延に対応する | 未検証 | | |
| 4-4 | `/api/apm/cpu-intensive` のトランザクションが記録される | 未検証 | | |
| 4-5 | APM Summary にスループットが表示される | 未検証 | | |
| 4-6 | トランザクショントレースが記録されている | 未検証 | | |
| 4-7 | NRQL でデータが取得できる | 未検証 | | |

## 05: カスタム計装

| # | 検証項目 | 状態 | 検証日 | 備考 |
|---|----------|------|--------|------|
| 5-1 | `function_trace` で内部関数が個別セグメントとして表示される | 未検証 | | |
| 5-2 | `background_task` が Non-web トランザクションとして記録される | 未検証 | | |
| 5-3 | カスタムアトリビュートがトランザクションに付与されている | 未検証 | | |
| 5-4 | NRQL でカスタムアトリビュートを使ったクエリが実行できる | 未検証 | | |

## 06: 分散トレーシング

| # | 検証項目 | 状態 | 検証日 | 備考 |
|---|----------|------|--------|------|
| 6-1 | 外部 HTTP 呼び出しが Span として記録される | 未検証 | | |
| 6-2 | 連鎖的な呼び出しが一つのトレースに紐付けられる | 未検証 | | |
| 6-3 | 並列呼び出しがトレース内で並行セグメントとして表示される | 未検証 | | |
| 6-4 | Distributed Tracing 画面でトレースマップが表示される | 未検証 | | |
| 6-5 | External services 画面に呼び出し先が表示される | 未検証 | | |
| 6-6 | NRQL で Span データを取得できる | 未検証 | | |

## 07: エラートラッキング

| # | 検証項目 | 状態 | 検証日 | 備考 |
|---|----------|------|--------|------|
| 7-1 | 未処理例外が New Relic に自動キャプチャされる | 未検証 | | |
| 7-2 | `notice_error()` で通知したエラーが記録される | 未検証 | | |
| 7-3 | HTTP エラー（4xx, 5xx）がエラーとして記録される | 未検証 | | |
| 7-4 | カスタムアトリビュート付きエラーの属性が NRQL で取得できる | 未検証 | | |
| 7-5 | Errors inbox にエラーが表示される | 未検証 | | |
| 7-6 | エラーのスタックトレースが確認できる | 未検証 | | |

## 08: Logs in Context

| # | 検証項目 | 状態 | 検証日 | 備考 |
|---|----------|------|--------|------|
| 8-1 | Python `logging` のログが New Relic に転送される | 未検証 | | |
| 8-2 | ログに `trace.id` と `span.id` が自動付与されている | 未検証 | | |
| 8-3 | APM のトランザクション詳細からログを参照できる | 未検証 | | |
| 8-4 | Distributed Tracing のトレース詳細からログを参照できる | 未検証 | | |
| 8-5 | 構造化ログの extra フィールドがログ属性として記録される | 未検証 | | |
| 8-6 | NRQL でログデータを取得できる | 未検証 | | |

## 09: カスタムイベント・メトリクス

| # | 検証項目 | 状態 | 検証日 | 備考 |
|---|----------|------|--------|------|
| 9-1 | `record_custom_event()` のイベントが NRQL で取得できる | 未検証 | | |
| 9-2 | カスタムイベントの属性が正しく記録される | 未検証 | | |
| 9-3 | `record_custom_metric()` のメトリクスが Metrics Explorer に表示される | 未検証 | | |
| 9-4 | バッチイベントが正しい件数分記録される | 未検証 | | |
| 9-5 | カスタムイベントの集計・FACET クエリが実行できる | 未検証 | | |

## サマリ

| 仕様 | 合計項目数 | 検証済み | 未検証 | 進捗 |
|------|-----------|---------|--------|------|
| 01: アプリケーション構成 | 5 | 0 | 5 | 0% |
| 02: Docker 構成 | 5 | 0 | 5 | 0% |
| 03: NR エージェント設定 | 6 | 0 | 6 | 0% |
| 04: APM 基本機能 | 7 | 0 | 7 | 0% |
| 05: カスタム計装 | 4 | 0 | 4 | 0% |
| 06: 分散トレーシング | 6 | 0 | 6 | 0% |
| 07: エラートラッキング | 6 | 0 | 6 | 0% |
| 08: Logs in Context | 6 | 0 | 6 | 0% |
| 09: カスタムイベント・メトリクス | 5 | 0 | 5 | 0% |
| **合計** | **50** | **0** | **50** | **0%** |
